<head>
    <link rel="stylesheet" href="/main.css">
    <link rel="stylesheet" href="admin.css">
</head>

<div class="auth">
    <input type="text" placeholder="Логин" class="username-input">
    <input type="password" placeholder="Пароль" class="password-input">
    <button class="login">Войти</button>
</div>

<script>
(function() { 
    const authData = localStorage.getItem("auth")
    const url = atob("aHR0cHM6Ly9oYW55by13cml0ZXMub215cmF1Y3kud29ya2Vycy5kZXYvYXV0aA==")
    const urlLogin = atob("aHR0cHM6Ly9oYW55by13cml0ZXMub215cmF1Y3kud29ya2Vycy5kZXYvbG9naW4=")
    const headers = { "Content-Type": "application/json" }
    // Если сохранилась запись об авторизации
    if (authData) {
        fetch(url, {
            method: "POST",
            headers,
            body: JSON.stringify({ authData })
        })
            .then(resp => resp.json())
            .then(data => {
                if (data.status === "OK") {
                    document.location.href = "dashboard.html"
                    localStorage.setItem('auth', data.account)
                }
                if (data.error) {
                    alert(data.error)
                }
            })
    }

    document.addEventListener('DOMContentLoaded', function () {
        // Если нет записи в localStorage, проверка пользователя 
        // по логину и паролю
        document.querySelector("button.login").onclick = () => {
            const username = document.querySelector(".username-input").value
            const password = document.querySelector(".password-input").value

            if (!username) {
                alert("Введите логин")
                document.querySelector(".username-input").focus()
                return
            }
            if (!password) {
                alert("Введите пароль")
                document.querySelector(".password-input").focus()
                return
            }

            const auth = btoa(JSON.stringify({ username, password }))

            fetch(urlLogin, {
                method: "POST",
                headers,
                body: JSON.stringify({ authData: auth })
            })
                .then(resp => resp.json())
                .then(data => {
                    if (data.status === "OK") {
                        localStorage.setItem("auth", data.auth)
                        document.location.href = "dashboard.html"
                    } else if (data.error) {
                        alert(data.error)
                    }
                })
        }
    })
})()
</script>